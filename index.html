<html>
<head>

    <script src='./bower_components/jquery/dist/jquery.min.js'></script>
    <script src='./bower_components/handlebars/handlebars.min.js'></script>

    <link rel="stylesheet" href="./bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
    <script src="./bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <script src='./bower_components/mapbox.js/mapbox.js'></script>
    <link href='./bower_components/mapbox.js/mapbox.css' rel='stylesheet'/>

    <script src='./bower_components/jquery-sheetrock/dist/jquery.sheetrock.min.js'></script>

    <link rel="stylesheet" type="text/css" href="assets/index.css">

    <title>Cville Innovation Map</title>
</head>
<body>

<header class="navbar navbar-fixed-top navbar-inverse">
    <div id="container">
        <div class="swissBold">
            <nav id="nav">
                <div id="logo"> CVILLization
                    <div id="subtitle1"> Charlottesville's Innovation Atlas <br>
                        Explore.find.connect with innovators
                        in charlottesville, virginia.
                    </div>
                </div>
                <nav>
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="index.html" title="Home"> HOME </a></li>
                        <li><a href="about.html" title="About"> ABOUT </a></li>
                        <li><a href="add.html" title="Add"> ADD YOUR COMPANY</a></li>
                    </ul>
                </nav>
            </nav>
        </div>
        </div>
</header>

<div id="map"></div>
<div id="infoSection">
    <div>
        <div id="bodySection"></div>

        <ul id="businessListing">
            <script id="businessTemplate" type="text/x-handlebars-template">
                <li class="business_listing_tile">
                    <strong>{{cells.Name}}</strong><br>
                    <em>{{cells.Tagline}}</em><br>
                    <a href="{{cells.Website}}">{{cells.Website}}</a>
                </li>
            </script>
        </ul>


        <script>

            var businessTemplate = Handlebars.compile($('#businessTemplate').html());

            L.mapbox.accessToken = 'pk.eyJ1IjoibWxha2U5MDAiLCJhIjoiSXV0UEF6dyJ9.8ZrYcafYb59U67LHErUegw';
            var map = L.mapbox.map('map', 'mlake900.lae6oebe').setView([38.04, -78.493], 14);

            var mySpreadsheet = 'https://docs.google.com/spreadsheets/d/11aIxy4FbfcqwUprsP4FB5tnVXmEu_TRoK6ffLz7s7Rk/edit#gid=66432575';

            var myRowHandler = function (row) {

                for (var key in row.cells) {
                    if (key.toLowerCase().indexOf("gps") > -1) {

                        var rawGpsString = row.cells[key];
                        var coordArray = rawGpsString.split(",", 2);

                        if ($.isNumeric(coordArray[0]) && $.isNumeric(coordArray[1])) {
                            var marker = L.marker(coordArray, {
                                title: row.cells.Name,
                                riseOnHover: true
                            });

                            //TODO: replace with handlebars template
                            marker.bindPopup("<b>" + row.cells.Name + "</b><br>" + row.cells.PhysicalAddress + "<br><em>" + row.cells.Tagline + "</em><br><a target='_blank' href='" + row.cells.Website + "'>" + row.cells.Website + "</a>");

                            marker.addTo(map);
                        }
                    }
                }

                return businessTemplate(row);
            };



            $('#businessListing').sheetrock({
                url: mySpreadsheet,
                headersOff: true,
                rowHandler: myRowHandler
            });

        </script>

    </div>
</div>
</body>
</html>
